package test.compilermods;
import org.sugarj.languages.Dryad;
import org.sugarj.languages.SugarDryad;
sugar stringmod{
	
	signature constructors
		PrefixString : A -> B
	
	strategies

		hook-dryad-final(|args) =
			not(hasAnno(?PrefixString(_)));
			where(<getAnno(?PrefixString(prfx))>args);
			topdown(try(\LDC(String(<id>)) -> LDC(String(<concat-strings>[prfx,"_",<id>]))\));
			setAnno(|PrefixString(None()))

		hook-dryad-init =
			?[path,imports,type]{t*};
			jdebug(!"hdi1");
			<fetch-elem(
				?SingleElemAnno(TypeName(Id("PrefixString")),Lit(String([Chars(prfx)])))
			)><getAllClassAnnos>type;
			jdebug(!"hdi2");
			![path,imports,<removeClassAnnos(?SingleElemAnno(TypeName(Id("PrefixString")),_))>type]{t*};
			setAnno(|PrefixString(prfx))
			; jdebug(!"hdi3")
}